{% extends "dashboard/coronavirus/layout.html" %}
{% block content %}
<div class="row">
<div class="col-xl-3 col-md-6">
        <div class="card">
            <div class="card-block">
                <div class="row align-items-center">
                    <div class="col-8">
                        <h4 class="text-c-yellow f-w-600">{{data['total_cases']}}</h4>
                        <h6 class="text-muted m-b-0">Coronavirus Cases</h6>
                    </div>
                    <div class="col-4 text-right">
                        <i class="feather icon-bar-chart f-28 text-c-yellow"></i>
                    </div>
                </div>
            </div>
            <div class="card-footer bg-c-yellow">
                <div class="row align-items-center">
                    <div class="col-9">
                        <p class="text-white m-b-0">{{ '%0.2f'| format(((data['total_cases'] | int - data['cases_plot'][1][-2] | int) * 100) / data['cases_plot'][1][-2] | int) }}% change since yesterday</p>
                    </div>
                    <div class="col-3 text-right">
                        {% if '%0.2f'| format(((data['total_cases'] | int - data['cases_plot'][1][-2] | int) * 100) / data['cases_plot'][1][-2] | int) | float < 0 %}                                                            
                            <i class="feather icon-trending-down text-white f-16"></i>
                        {% else %}
                            <i class="feather icon-trending-up text-white f-16"></i>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6">
        <div class="card">
            <div class="card-block">
                <div class="row align-items-center">
                    <div class="col-8">
                        <h4 class="text-c-pink f-w-600">{{data['total_deaths']}}</h4>
                        <h6 class="text-muted m-b-0">Deaths</h6>
                    </div>
                    <div class="col-4 text-right">
                        <i class="feather icon-users f-28 text-c-pink"></i>
                    </div>
                </div>
            </div>
            <div class="card-footer bg-c-pink">
                <div class="row align-items-center">
                    <div class="col-9">
                        <p class="text-white m-b-0">{{ '%0.2f'| format(((data['total_deaths'] | int - deaths['total_deaths'][1][1] | int) * 100) / deaths['total_deaths'][1][1] | int) }}% change since yesterday</p>
                    </div>
                    <div class="col-3 text-right">
                        {% if '%0.2f'| format(((data['total_deaths'] | int - deaths['total_deaths'][1][1] | int) * 100) / deaths['total_deaths'][1][1] | int) | float < 0%}
                            <i class="feather icon-trending-down text-white f-16"></i>
                        {% else %}
                            <i class="feather icon-trending-up text-white f-16"></i>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6">
        <div class="card">
            <div class="card-block">
                <div class="row align-items-center">
                    <div class="col-8">
                        <h4 class="text-c-green f-w-600">{{data['total_recovered']}}</h4>
                        <h6 class="text-muted m-b-0">Recovered</h6>
                    </div>
                    <div class="col-4 text-right">
                        <i class="feather icon-heart f-28 text-c-green"></i>
                    </div>
                </div>
            </div>
            <div class="card-footer bg-c-green">
                <div class="row align-items-center">
                    <div class="col-9">
                        <p class="text-white m-b-0">{{ '%0.2f'| format(((data['total_recovered'] | int - (data['cases_plot'][1][-2] | int - data['active_cases_plot'][1][-1] | int - deaths['total_deaths'][1][1] | int)) * 100) /  (data['cases_plot'][1][-2] | int - data['active_cases_plot'][1][-1] | int - deaths['total_deaths'][1][1] | int)) }}% change since yesterday</p>
                    </div>
                    <div class="col-3 text-right">
                        {% if '%0.2f'| format(((data['total_recovered'] | int - (data['cases_plot'][1][-2] | int - data['active_cases_plot'][1][-1] | int - deaths['total_deaths'][1][1] | int)) * 100) /  (data['cases_plot'][1][-2] | int - data['active_cases_plot'][1][-1] | int - deaths['total_deaths'][1][1] | int)) | float < 0 %}
                            <i class="feather icon-trending-down text-white f-16"></i>
                        {% else %}
                            <i class="feather icon-trending-up text-white f-16"></i>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6">
        <div class="card">
            <div class="card-block">
                <div class="row align-items-center">
                    <div class="col-8">
                        <h4 class="text-c-blue f-w-600">{{data['active_cases']}}</h4>
                        <h6 class="text-muted m-b-0">Active Cases</h6>
                    </div>
                    <div class="col-4 text-right">
                        <i class="feather icon-eye f-28 text-c-blue"></i>
                    </div>
                </div>
            </div>
            <div class="card-footer bg-c-blue">
                <div class="row align-items-center">
                    <div class="col-9">
                        <p class="text-white m-b-0">{{ '%0.2f'| format(((data['active_cases'] | int - data['active_cases_plot'][1][-1] | int) * 100) / data['active_cases_plot'][1][-1] | int) }}% change since yesterday</p>
                    </div>
                    <div class="col-3 text-right">
                        {% if '%0.2f'| format(((data['active_cases'] | int - data['active_cases_plot'][1][-1] | int) * 100) / data['active_cases_plot'][1][-1] | int) | float < 0 %}
                            <i class="feather icon-trending-down text-white f-16"></i>
                        {% else %}
                            <i class="feather icon-trending-up text-white f-16"></i>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- task, page, download counter  end -->

    <!-- visitor start -->
    <div class="col-xl-8 col-md-12">
        <div class="card">
            <div class="card-header">
                <h5>Confirmed Deaths</h5>
                <span>{{data['last_updated']}}</span>
                <div class="card-header-right">
                    <ul class="list-unstyled card-option">
                        <li><i class="feather icon-maximize full-card"></i></li>
                    </ul>
                </div>
            </div>
            <div class="card-block">
                <div id="cases_chart" style="height:300px"></div>
            </div>
        </div>
    </div>
    <div class="col-xl-4 col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>Coronavirus Cases Distribution Chart</h5>
            </div>
            <div class="card-block">
                <div id="cases_doughnut"></div>
            </div>
            <div class="card-footer ">
                <div class="row text-center b-t-default">
                    <div class="col-4 m-t-15">
                        <h5>{{ '%0.2f'| format((data['total_deaths'] | int  * 100) / data['total_cases'] | int) }}%</h5>
                        <p class="text-muted m-b-0">Total Deaths</p>
                    </div>
                    <div class="col-4 b-r-default m-t-15">
                        <h5>{{ '%0.2f'| format((data['active_cases'] | int  * 100) / data['total_cases'] | int) }}%</h5>
                        <p class="text-muted m-b-0">Active Cases</p>
                    </div>
                    <div class="col-4 b-r-default m-t-15">
                        <h5>{{ '%0.2f'| format((data['total_recovered'] | int  * 100) / data['total_cases'] | int) }}%</h5>
                        <p class="text-muted m-b-0">Total Recovered</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-6 col-md-12">
        <div class="card table-card">
            <div class="card-header">
                <h5>Confirmed Cases and Deaths by Country ({{countries['countries_affected'] | int }} affected)</h5>
            </div>
            <div class="card-block">
                <div class="table-responsive">
                    <table class="table table-hover table-borderless">
                        <thead>
                            <tr>
                                <th>Flag</th>
                                <th>Country</th>
                                <th>Total cases</th>
                                <th class="text-right">Total deaths</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for country in countries['countries_adv_data'][:5] %}
                                <tr>
                                    <td><img src="{{ url_for('static', filename='images/countries/' + country[0] + '.png')}}" alt="" class="img-fluid img-30"></td>
                                    <td>{{country[0]}}</td>
                                    <td>{{country[1]}}</td>
                                    <td class="text-right">{{country[3]}}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="text-right  m-r-20">
                    <a href="{{url_for('main.countries')}}" class="b-b-primary text-primary">View all Coronavirus Confirmed Locations</a>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-6 col-md-12">
        <div class="card">
            <div class="card-header">
                <h5>Age of Coronavirus Deaths</h5>
            </div>
            <div class="card-block">
                <div id="age_chart"></div>
            </div>
            <div class="card-footer">
                <h6 class="m-b-20">Death Rate Of Confirmed Cases By Sex</h6>
                <div class="row text-center">
                    <div class="col-6 b-r-default">
                        <h6 class="text-muted m-b-10">{{demographics['death_rate_by_sex'][0][0]}}</h6>
                        <h4 class="m-b-0 f-w-600 ">{{demographics['death_rate_by_sex'][0][1]}}</h4>
                    </div>
                    <div class="col-6">
                        <h6 class="text-muted m-b-10">{{demographics['death_rate_by_sex'][1][0]}}</h6>
                        <h4 class="m-b-0 f-w-600 ">{{demographics['death_rate_by_sex'][1][1]}}</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-7 col-md-12">
        <div class="card social-network">
            <div class="card-header">
                <h5>Coronavirus Tests Performed by Countries</h5>
            </div>
            <div class="card-block">
                <div class="row">
                    <div id="tests_chart" style="height: 500px;"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-5 col-md-12">
        <div class="card social-network">
            <div class="card-header">
                <h5>COVID-19 Fatality Rate by Pre-existing medical conditions</h5>
            </div>
            <div class="card-block">
                <div class="row">
                    <div id="disease_chart" style="height: 500px;"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script>
    am4core.ready(function() {

    // Themes begin
    am4core.useTheme(am4themes_animated);
    // Themes end

    // Create chart instance
    var plot = am4core.create("cases_chart", am4charts.XYChart);

    // Add data
    plot.data = [
        {% for item in deaths['total_deaths'] | reverse %}
            {date: '{{loop.index}}', value: '{{ item[1] }}' },
        {% endfor %}
    ];

    // Set input format for the dates

    // Create axes
    var dateAxis = plot.xAxes.push(new am4charts.ValueAxis());
    var valueAxis = plot.yAxes.push(new am4charts.ValueAxis());

    dateAxis.title.text = "Day (since January 23)";
    valueAxis.title.text = "Deaths";

    // Create series
    var series = plot.series.push(new am4charts.LineSeries());
    series.dataFields.valueY = "value";
    series.dataFields.valueX = "date";
    series.tooltipText = "{value} deaths"
    series.strokeWidth = 2;
    series.minBulletDistance = 15;

    // Drop-shaped tooltips
    series.tooltip.background.cornerRadius = 20;
    series.tooltip.background.strokeOpacity = 0;
    series.tooltip.pointerOrientation = "vertical";
    series.tooltip.background.fill = am4core.color("#fff");
    series.tooltip.label.fill = am4core.color("#000");
    series.tooltip.label.minWidth = 40;
    series.tooltip.label.minHeight = 40;
    series.tooltip.label.textAlign = "middle";
    series.tooltip.label.textValign = "middle";

    // Make bullets grow on hover
    var bullet = series.bullets.push(new am4charts.CircleBullet());
    bullet.circle.strokeWidth = 2;
    bullet.circle.radius = 4;
    bullet.circle.fill = am4core.color("#fff");

    var bullethover = bullet.states.create("hover");
    bullethover.properties.scale = 1.5;

    // Make a panning cursor
    plot.cursor = new am4charts.XYCursor();
    plot.cursor.behavior = "panXY";
    plot.cursor.xAxis = dateAxis;
    plot.cursor.snapToSeries = series;

    // Create vertical scrollbar and place it before the value axis
    plot.scrollbarY = new am4core.Scrollbar();
    plot.scrollbarY.parent = plot.leftAxesContainer;
    //plot.scrollbarY.toBack();

    // Create a horizontal scrollbar with previe and place it underneath the date axis
    plot.scrollbarX = new am4charts.XYChartScrollbar();
    plot.scrollbarX.series.push(series);
    plot.scrollbarX.parent = plot.bottomAxesContainer;
    plot.scrollbarX.showSystemTooltip = false;
    plot.scrollbarX.thumb.showSystemTooltip = false;
    plot.scrollbarX.startGrip.showSystemTooltip = false;
    plot.scrollbarX.endGrip.showSystemTooltip = false;

    });
</script>
<script>
    am4core.ready(function() {

    // Themes begin
    am4core.useTheme(am4themes_animated);

    var pie_chart = am4core.create("cases_doughnut", am4charts.PieChart);

    pie_chart.data = [
    { "statistics": "Total Deaths" , "value": '{{ data['total_deaths'] }}' },
    { "statistics": "Active Cases" , "value": '{{ data['active_cases'] }}' },
    { "statistics": "Total Recovered" , "value": '{{ data['total_recovered'] }}' }
    ];


    pie_chart.hiddenState.properties.opacity = 0; // this creates initial fade-in

    pie_chart.innerRadius = 80;
    var label = pie_chart.seriesContainer.createChild(am4core.Label);
    label.text = '{{ data['total_cases'] }}';
    label.horizontalCenter = "middle";
    label.verticalCenter = "middle";
    label.fontSize = 40;

    var series = pie_chart.series.push(new am4charts.PieSeries());
    series.dataFields.value = "value";
    series.dataFields.category = "statistics";

    }); // end am4core.ready()
</script>
<script>
    am4core.ready(function() {

    // Themes begin
    am4core.useTheme(am4themes_animated);

    var age_chart = am4core.create("age_chart", am4charts.XYChart);

    age_chart.data = [
        {% for item in demographics['death_rate_by_age'] | reverse %}
            {age: '{{item[0]}}', fatality: '{{ item[1] }}' },
        {% endfor %}
    ];

    var categoryAxis = age_chart.xAxes.push(new am4charts.CategoryAxis());
    categoryAxis.dataFields.category = "age";
    categoryAxis.renderer.grid.template.location = 0;
    categoryAxis.renderer.minGridDistance = 30;

    categoryAxis.renderer.labels.template.adapter.add("dy", function(dy, target) {
    if (target.dataItem && target.dataItem.index & 2 == 2) {
        return dy + 25;
    }
    return dy;
    });

    var valueAxis = age_chart.yAxes.push(new am4charts.ValueAxis());

    // Create series
    var series = age_chart.series.push(new am4charts.ColumnSeries());
    series.dataFields.valueY = "fatality";
    series.dataFields.categoryX = "age";
    series.name = "Death Rate by Age";
    series.columns.template.tooltipText = "{categoryX} years old: [bold]{valueY}%[/]";
    series.columns.template.fillOpacity = .8;

    var columnTemplate = series.columns.template;
    columnTemplate.strokeWidth = 2;
    columnTemplate.strokeOpacity = 1;

    }); // end am4core.ready()
</script>
<script>
    am4core.ready(function() {

    // Themes begin
    am4core.useTheme(am4themes_animated);
    // Themes end

    // Create chart instance
    var chart = am4core.create("tests_chart", am4charts.XYChart);
    chart.scrollbarX = new am4core.Scrollbar();
    // Add data
    chart.data = [
        {% for item in tests['tests_data'] %}
            {category: '{{item[0]}}', value: parseInt('{{ item[1] | int}}') },
        {% endfor %}
    ];

    var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
    categoryAxis.dataFields.category = "category";
    categoryAxis.renderer.grid.template.location = 0;
    categoryAxis.renderer.minGridDistance = 30;
    categoryAxis.renderer.labels.template.horizontalCenter = "right";
    categoryAxis.renderer.labels.template.verticalCenter = "middle";
    categoryAxis.renderer.labels.template.rotation = 270;
    categoryAxis.tooltip.disabled = true;
    categoryAxis.renderer.minHeight = 110;

    var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
    valueAxis.renderer.minWidth = 50;

    // Create series
    var series = chart.series.push(new am4charts.ColumnSeries());
    series.sequencedInterpolation = true;
    series.dataFields.valueY = "value";
    series.dataFields.categoryX = "category";

    series.columns.template.column.cornerRadiusTopLeft = 10;
    series.columns.template.column.cornerRadiusTopRight = 10;
    series.columns.template.column.fillOpacity = 0.8;

    var labelBullet = series.bullets.push(new am4charts.LabelBullet());
    labelBullet.label.verticalCenter = "bottom";
    labelBullet.label.dy = -10;
    labelBullet.label.text = "{value}"
    // on hover, make corner radiuses bigger
    var hoverState = series.columns.template.column.states.create("hover");
    hoverState.properties.cornerRadiusTopLeft = 0;
    hoverState.properties.cornerRadiusTopRight = 0;
    hoverState.properties.fillOpacity = 1;

    series.columns.template.adapter.add("fill", function(fill, target) {
    return chart.colors.getIndex(target.dataItem.index);
    });

});
</script>
<script>
    am4core.useTheme(am4themes_animated);

    // Create chart instance
    var chart = am4core.create("disease_chart", am4charts.XYChart);

    // Add data
    chart.data = [
        {% for item in demographics['pre_existing_conditions'] %}
            {category: '{{item[0]}}', value: '{{ item[-1] }}' },
        {% endfor %}
    ];

    var categoryAxis = chart.yAxes.push(new am4charts.CategoryAxis());
    categoryAxis.dataFields.category = "category";
    categoryAxis.renderer.grid.template.location = 0;

    var valueAxis = chart.xAxes.push(new am4charts.ValueAxis());

    var series = chart.series.push(new am4charts.ColumnSeries());
    series.dataFields.valueX = "value";
    series.dataFields.categoryY = "category";

    var valueLabel = series.bullets.push(new am4charts.LabelBullet());
    valueLabel.label.text = "{value.formatNumber('#.00')}%";
    valueLabel.label.horizontalCenter = "left";
    valueLabel.label.dx = 5;
    valueLabel.label.fontSize = 20;
</script>
{% endblock %}


